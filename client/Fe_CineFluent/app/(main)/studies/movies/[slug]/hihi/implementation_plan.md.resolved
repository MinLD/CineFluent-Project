# External Movie Integration - Implementation Plan

## Má»¥c TiÃªu
TÃ­ch há»£p phim tá»« nguá»“n ngoÃ i (VidSrc) + phá»¥ Ä‘á» (OpenSubtitles) vÃ o CineFluent Ä‘á»ƒ há»c tiáº¿ng Anh.

---

## ğŸ—ï¸ BACKEND MODULES

### Module 1: TMDb Service
**File**: `app/services/tmdb_service.py`

| Chá»©c nÄƒng | MÃ´ táº£ |
|-----------|-------|
| `search_movie(query)` | TÃ¬m phim theo tÃªn â†’ Tráº£ vá» list káº¿t quáº£ |
| `get_movie_details(tmdb_id)` | Láº¥y chi tiáº¿t phim (IMDb ID, poster, description...) |

**API cáº§n Ä‘Äƒng kÃ½**: https://www.themoviedb.org/settings/api (Miá»…n phÃ­)

---

### Module 2: OpenSubtitles Service
**File**: `app/services/opensubtitles_service.py`

| Chá»©c nÄƒng | MÃ´ táº£ |
|-----------|-------|
| `search_subtitles(imdb_id, lang)` | TÃ¬m sub theo IMDb ID + ngÃ´n ngá»¯ |
| `download_subtitle(file_id)` | Táº£i file .srt vá» |
| `parse_srt(srt_content)` | Chuyá»ƒn .srt â†’ List[{start, end, text}] |

**API cáº§n Ä‘Äƒng kÃ½**: https://www.opensubtitles.com/en/consumers (Free: 100 downloads/ngÃ y)

---

### Module 3: Translation Service (CÃ³ sáºµn)
**File**: [app/services/learning_service.py](file:///d:/Projects/CineFluent-Project/server/be_flask_cinefluent/app/services/learning_service.py) (Ä‘Ã£ cÃ³)

| Chá»©c nÄƒng | MÃ´ táº£ |
|-----------|-------|
| `translate_text(text, target_lang)` | Dá»‹ch EN â†’ VI náº¿u khÃ´ng cÃ³ sub VI |

---

### Module 4: VidSrc Service
**File**: `app/services/vidsrc_service.py`

| Chá»©c nÄƒng | MÃ´ táº£ |
|-----------|-------|
| `get_stream_url(imdb_id)` | Láº¥y HLS stream URL tá»« VidSrc |
| `get_embed_url(imdb_id)` | Láº¥y iframe embed URL (fallback) |

**API**: https://vidsrc.xyz (KhÃ´ng cáº§n Ä‘Äƒng kÃ½)

---

### Module 5: External Movie Controller
**File**: `app/controller/external_movie_controller.py`

| Endpoint | Method | MÃ´ táº£ |
|----------|--------|-------|
| `/api/v1/external/search` | GET | TÃ¬m phim tá»« TMDb |
| `/api/v1/external/import` | POST | Import phim + táº£i sub + lÆ°u DB |
| `/api/v1/external/{id}/stream` | GET | Tráº£ vá» stream URL |
| `/api/v1/external/{id}/subtitles` | GET | Tráº£ vá» sub tá»« DB |

---

### Module 6: Database Updates
**File**: Migration script

```sql
-- Cáº­p nháº­t báº£ng videos
ALTER TABLE videos ADD COLUMN source_type ENUM('youtube', 'external') DEFAULT 'youtube';
ALTER TABLE videos ADD COLUMN imdb_id VARCHAR(20) NULL;
ALTER TABLE videos ADD COLUMN stream_url TEXT NULL;

-- Báº£ng subtitles giá»¯ nguyÃªn (Ä‘Ã£ cÃ³ sáºµn)
```

---

## ğŸ¨ FRONTEND MODULES

### Module 7: External Movie Search Page
**File**: `app/(main)/studies/external-movies/page.tsx`

| Component | Chá»©c nÄƒng |
|-----------|-----------|
| `SearchInput` | Ã” tÃ¬m kiáº¿m phim |
| `MovieResults` | Danh sÃ¡ch káº¿t quáº£ tá»« TMDb |
| `ImportButton` | NÃºt import phim vá» CineFluent |

---

### Module 8: External Video Player
**File**: `app/components/movies/ExternalVideoPlayer.tsx`

| Component | Chá»©c nÄƒng |
|-----------|-----------|
| `HLSPlayer` | Player HTML5 + HLS.js Ä‘á»ƒ chÆ¡i stream |
| `SyncControls` | NÃºt Ä‘iá»u chá»‰nh offset sub (+1s/-1s) |

---

### Module 9: Unified SubtitlePanel (TÃ¡i sá»­ dá»¥ng)
**File**: [app/components/movies/SubtitlePanel.tsx](file:///d:/Projects/CineFluent-Project/client/Fe_CineFluent/app/components/movies/SubtitlePanel.tsx) (Ä‘Ã£ cÃ³)

KhÃ´ng cáº§n sá»­a! Chá»‰ cáº§n truyá»n data sub tá»« API má»›i.

---

### Module 10: Learning Features (TÃ¡i sá»­ dá»¥ng)
- `DictionaryPopup` (Ä‘Ã£ cÃ³)
- `DictationMode` (Ä‘Ã£ cÃ³)
- `VocabularyList` (Ä‘Ã£ cÃ³)

---

## ğŸ“‹ LUá»’NG HOáº T Äá»˜NG

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USER: TÃ¬m "Kung Fu Panda"                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FRONTEND: Gá»i /api/v1/external/search?q=Kung+Fu+Panda      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BACKEND: TMDb Service â†’ Tráº£ vá» list phim + IMDb ID         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USER: Click "Import" phim                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BACKEND:                                                   â”‚
â”‚  1. OpenSubtitles â†’ Táº£i sub EN + VI                         â”‚
â”‚  2. Parse .srt â†’ LÆ°u vÃ o báº£ng subtitles                     â”‚
â”‚  3. VidSrc â†’ Láº¥y stream URL                                 â”‚
â”‚  4. LÆ°u video info vÃ o báº£ng videos                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FRONTEND:                                                  â”‚
â”‚  1. HLSPlayer â†’ PhÃ¡t video tá»« stream URL                    â”‚
â”‚  2. SubtitlePanel â†’ Hiá»ƒn thá»‹ sub tá»« DB                      â”‚
â”‚  3. Learning features â†’ Hoáº¡t Ä‘á»™ng nhÆ° YouTube!              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## â±ï¸ Æ¯á»šC TÃNH THá»œI GIAN

| Phase | Modules | Thá»i gian |
|-------|---------|-----------|
| **Phase 1** | TMDb + OpenSubtitles Services | 2-3 giá» |
| **Phase 2** | VidSrc Service + Controller | 1-2 giá» |
| **Phase 3** | Database Migration | 30 phÃºt |
| **Phase 4** | Search Page UI | 1-2 giá» |
| **Phase 5** | HLS Player + Integration | 2-3 giá» |
| **Phase 6** | Testing & Polish | 1-2 giá» |

**Tá»•ng**: ~8-12 giá» lÃ m viá»‡c

---

## ğŸ”‘ API KEYS Cáº¦N CHUáº¨N Bá»Š

1. **TMDb API Key**: https://www.themoviedb.org/settings/api
2. **OpenSubtitles API Key**: https://www.opensubtitles.com/en/consumers

Anh Ä‘Äƒng kÃ½ sáºµn 2 API key nÃ y, rá»“i bÃ¡o em báº¯t Ä‘áº§u code nhÃ©!
